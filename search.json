[{"title":"git","url":"/2023/11/22/git/","content":"\n### 拉取远端代码\n\ngit pull origin master\n\n### 仓库中的远程仓库\n\ngit remote -v\n\n![git](https://cdn.jsdelivr.net/gh/shirllyz/imgBlog/2831503-20220906093515510-391251083.png)\n","tags":["git"],"categories":["git"]},{"title":"MarkDown","url":"/2023/11/22/MarkDown/","content":"\n### MarkDown\n\n#### 标题\n\n##### #+空格+标题名字\n\n一级标题一个#号\n二级标题两个#号\n\n#### 字体\n\n##### 粗体\n\n- **字体内容**\n\n##### 斜体\n\n- *字体内容*\n\n##### 斜体+粗体\n\n- ***字体内容***\n\n##### 删除线\n\n\n\n+ ~~字体内容~~\n\n#### 引用\n\n##### >+空格+字体内容\n\n引用别人的话\n\n### 分割线\n\n##### ---\n\n##### ***\n\n### 图片\n\n#### ![图片名字]（地址）\n\n### 超链接\n\n#### [链接名字]（跳转地址）\n\n### 列表\n\n#### 有序列表\n\n- 1，空格\n\n#### 无序列表\n\n- -空格\n\n### 表格\n\n#### 名字|性别|生日\n\n##### --|--|--|\n\n##### 张三|男|1997\n\n### 代码\n\n#### ···（tab上面）\n","tags":["markdown"],"categories":["markdown"]},{"title":"常用php操作","url":"/2023/11/22/常用php操作/","content":"\n### 处理数据单元,处理富文本截取\n\n```php\nfunction extract_text($html, $length) {\n        // 剥离HTML标签\n        $text = strip_tags($html);\n        // 提取前100个字符\n        $text = mb_substr($text, 0, $length, 'UTF-8');\n \n        // 如果截取的位置刚好在HTML标签内，则去除截断的不完整标签\n        $lastTagEndPos = strrpos($text, '>');\n        $lastTagStartPos = strrpos($text, '<');\n        if ($lastTagStartPos !== false && $lastTagEndPos === false) {\n            $text = mb_substr($text, 0, $lastTagStartPos, 'UTF-8');\n        }\n \n        // 如果截取的位置在HTML实体编码内，则将实体编码转换回原始字符\n        $text = html_entity_decode($text, ENT_QUOTES | ENT_HTML5, 'UTF-8');\n \n        return $text;\n    }\n \n    private function getItem($news)\n    {\n        foreach ($news as &$v){\n//            $item = $item->getData();\n            $v['year'] = date('Y', $v['add_time']); // 获取时间戳的年份\n            $v['month'] = date('m', $v['add_time']); // 获取时间戳的月份\n            $v['day'] = date('d', $v['add_time']); // 获取时间戳的日期\n            $v['add_time'] = date(\"Y-m-d H:i\", $v['add_time']);\n            $v['url'] = MyUrl('index/article/index', ['id'=>$v['id']]);\n            $v['intro']=$result = $this->extract_text($v['content'], 100);\n            unset($v['content']);\n        }\n        return $news;\n//        pd($news);\n    }\n```\n\n### 二维数组去重\n\n```php\n//二维数组去重\nfunction assoc_unique($arr, $key) {\n    $tmp_arr = array();\n    foreach ($arr as $k => $v) {\n        if (in_array($v[$key], $tmp_arr)) {//搜索$v[$key]是否在$tmp_arr数组中存在，若存在返回true\n            unset($arr[$k]);\n        } else {\n            $tmp_arr[] = $v[$key];\n        }\n    }\n    sort($arr); //sort函数对数组进行排序\n    return $arr;\n}\n```\n\n### 检测网址是否可以访问\n\n```php\n//检测网址是否可以访问\nfunction check_url($url)\n{\n    if (@fopen($url, 'r') == false) {\n        return false;\n    }\n    return true;\n}\n```\n\n### 根据键值，对二维数组重新进行分组\n\n```php\n/**<br>　　　*PHP根据键值，对二维数组重新进行分组\n   * [array_group_by ph]\n   * @param  [type] $arr [二维数组]\n   * @param  [type] $key [键名]\n   * @return [type]      [新的二维数组]\n   */\n  function array_group_by($arr, $key){\n      $grouped = array();\n      foreach ($arr as $value) {\n          $grouped[$value[$key]][] = $value;\n      }\n      if (func_num_args() > 2) {\n          $args = func_get_args();\n          foreach ($grouped as $key => $value) {\n              $parms = array_merge($value, array_slice($args, 2, func_num_args()));\n              $grouped[$key] = call_user_func_array('array_group_by', $parms);\n          }\n      }\n      return $grouped;\n  }\n```\n\n### 根据时间判断是否执行某个操作\n\n```php\nfunction get_time($start,$end){\n    //判断当前时间是否在时间段内，如果是，则执行\n    $Day = date('Y-m-d ',time());\n    $timeBegin = strtotime($Day.$start.\":00\");\n    $timeEnd = strtotime($Day.$end.\":00\");\n    $curr_time = time();\n    if($curr_time >= $timeBegin && $curr_time <= $timeEnd){\n        return true;\n    }\n    return false;\n}\n \nfunction isCorrectTime(){\n    $time = time();\n    $w = date('w',$time);\n    if(!($w != 0 and $w != 6))\n    {\n        //双休日\n        return false;\n    }\n    //工作日\n    //判断是否在规定时间内\n    return get_time('8:30','18:00');\n}\n```\n\n### 调试打印\n\n```php\n/**\n * 打印调试函数\n * @param $content\n * @param $is_die\n */\nfunction pre($content, $is_die = true)\n{\n    header('Content-type: text/html; charset=utf-8');\n    echo '<pre>' . print_r($content, true);\n    $is_die && die();\n}\n\nfunction pp($data,$is_die=true)\n{\n  // 定义样式\n  $str = '<pre style=\"display: block;padding: 9.5px;margin: 44px 0 0 0;font-size: 13px;line-height: 1.42857;color: red;word-break: break-all;word-wrap: break-word;background-color: #F5F5F5;border: 1px solid #CCC;border-radius: 4px;\">';\n  // 如果是boolean或者null直接显示文字；否则print\n  if (is_bool($data)) {\n    $show_data = $data ? 'true' : 'false';\n  } elseif (is_null($data)) {\n    $show_data = 'null';\n  } else {\n    $show_data = print_r($data, true);\n  }\n  $str .= $show_data;\n  $str .= '</pre>';\n  echo $str;\n  $is_die && die();\n}\n\n\n\n\n\n\nfunction pd($data)\n{\n  // 定义样式\n  $str = '<pre style=\"display: block;padding: 9.5px;margin: 44px 0 0 0;font-size: 13px;line-height: 1.42857;color: #333;word-break: break-all;word-wrap: break-word;background-color: #F5F5F5;border: 1px solid #CCC;border-radius: 4px;\">';\n  // 如果是boolean或者null直接显示文字；否则print\n  if (is_bool($data)) {\n    $show_data = $data ? 'true' : 'false';\n  } elseif (is_null($data)) {\n    $show_data = 'null';\n  } else {\n    $show_data = print_r($data, true);\n  }\n  $str .= $show_data;\n  $str .= '</pre>';\n  echo $str;\n  die;\n}\nfunction p($data)\n{\n  // 定义样式\n  $str = '<pre style=\"display: block;padding: 9.5px;margin: 44px 0 0 0;font-size: 13px;line-height: 1.42857;color: #333;word-break: break-all;word-wrap: break-word;background-color: #F5F5F5;border: 1px solid #CCC;border-radius: 4px;\">';\n  // 如果是boolean或者null直接显示文字；否则print\n  if (is_bool($data)) {\n    $show_data = $data ? 'true' : 'false';\n  } elseif (is_null($data)) {\n    $show_data = 'null';\n  } else {\n    $show_data = print_r($data, true);\n  }\n  $str .= $show_data;\n  $str .= '</pre>';\n  echo $str;\n}\n```\n\n### 利用PhpOfficePhpSpreadsheet实现导入导出功能\n\n注意:\n\n1. 之前有用过`PHPExcel`导出过数据,这个是一个不再维护的版本,对于php版本有要求,可以实现功能,但是考虑到`不再维护`和`版本要求在7.2以下`,使用方式为:\n   1. 安装`composer require phpoffice/phpexcel`:\n   2. 使用:\n\n```php\n public function clientExcel($data = [],$name = 'excel')\n     {\n         $excel = new \\PHPExcel(); //引用phpexcel\n         iconv('UTF-8', 'gb2312', $name); //针对中文名转码\n //        $header = ['订单编号', '订单状态', '客户名字', '订单名字', '创建时间','订单备注','开料尺寸','印件色数','印件色别','印刷方式','成品尺寸','印刷板数','千印数量']; //表头,名称可自定义\n         $excel->setActiveSheetIndex(0);\n         $excel->getActiveSheet()->setTitle($name); //设置表名\n         $excel->getActiveSheet()->getDefaultRowDimension()->setRowHeight(18);\n //        $excel->getActiveSheet()->getColumnDimension('B')->setWidth(80);\n \n         $letter = ['A', 'B', 'C','D','E'];//列坐标\n \n         //设置表头\n         $excel->setActiveSheetIndex(0)\n             ->setCellValue('A1', '商品编号')\n             ->setCellValue('B1', '商品型号')\n             ->setCellValue('C1', '销售价格')\n             ->setCellValue('D1', '库存数')\n             ->setCellValue('E1', '仓库名称');\n \n         //写入数据\n         foreach ($data as $k => $v) {\n             //从第二行开始写入数据（第一行为表头）\n             //$excel->getActiveSheet()->setCellValue('A'.($k+2),$v['gid']);\n             $excel->getActiveSheet()->setCellValue('A' . ($k + 2), $v['goods_id'].\"\\t\");\n             $excel->getActiveSheet()->setCellValue('B' . ($k + 2), $v['goods']['model']);\n             $excel->getActiveSheet()->setCellValue('C' . ($k + 2), $v['goods']['price']);\n             $excel->getActiveSheet()->setCellValue('D' . ($k + 2), $v['inventory']);\n             $excel->getActiveSheet()->setCellValue('E' . ($k + 2), $v['warehouse_name']);\n         }\n \n         //设置单元格边框\n         $excel->getActiveSheet()->getStyle(\"A1:E\" . (count($data) + 1))->getBorders()->getAllBorders()->setBorderStyle();\n \n         ob_end_clean();\n         header('Content-Type: application/vnd.ms-excel');\n         header('Content-Disposition: attachment;filename=\"' . $name . '.xls\"');\n         header('Cache-Control: max-age=0');\n \n \n         $res_excel = PHPExcel_IOFactory::createWriter($excel, 'Excel2007');\n         $res_excel->save('php://output');\n     }\n```\n\n### phpspreadsheet使用\n\n#### 1. 安装\n\n```bash\n composer require phpoffice/phpspreadsheet\n```\n\n#### 2. 导出\n\n查询数据\n\n```php\n public function test(){\n         // 获取数据列表\n         $data_params = [\n             'n'=>9999, 　　　　　　　　'field'=>'id,model,min_price,brand_id,brand_name,price,original_price,goods_time,inventory,inventory_unit,access_count,add_time,upd_time',\n         ];\n         $ret = GoodsService::GoodsListWithPriceTable($data_params);\n         $excel = new Office();\n         //设置表头：\n         $head = ['编号', '型号', '品牌id', '品牌名', '价格','原价','货期','库存','库存单位','访问人数','阶梯价格'];\n         //数据中对应的字段，用于读取相应数据：\n         $keys = ['id', 'model', 'brand_id', 'brand_name', 'price' ,'original_price' ,'goods_time' ,'inventory' ,'inventory_unit' ,'access_count','price_table'];\n \n         $excel->outdataWithPriceTable('产品信息表', $ret['data'], $head, $keys);\n     }\n```\n\n导出的功能实现类\n\n```php\n <?php\n \n namespace app\\service;\n use PhpOffice\\PhpSpreadsheet\\Spreadsheet;\n use PhpOffice\\PhpSpreadsheet\\Writer\\Xlsx;\n \n class Office\n {\n     /**\n      * 导出excel表\n      * $data：要导出excel表的数据，接受一个二维数组\n      * $name：excel表的表名\n      * $head：excel表的表头，接受一个一维数组\n      * $key：$data中对应表头的键的数组，接受一个一维数组\n      * 备注：此函数缺点是，表头（对应列数）不能超过26；\n      *循环不够灵活，一个单元格中不方便存放两个数据库字段的值\n      */\n     public function outdata($name='测试表', $data=[], $head=[], $keys=[])\n     {\n         $count = count($head);  //计算表头数量\n \n         $spreadsheet = new Spreadsheet();\n         $sheet = $spreadsheet->getActiveSheet();\n \n         for ($i = 65; $i < $count + 65; $i++) {     //数字转字母从65开始，循环设置表头：\n             $sheet->setCellValue(strtoupper(chr($i)) . '1', $head[$i - 65]);\n         }\n \n         /*--------------开始从数据库提取信息插入Excel表中------------------*/\n \n \n         foreach ($data as $key => $item) {             //循环设置单元格：\n             //$key+2,因为第一行是表头，所以写到表格时   从第二行开始写\n \n             for ($i = 65; $i < $count + 65; $i++) {     //数字转字母从65开始：\n                 $sheet->setCellValue(strtoupper(chr($i)) . ($key + 2), $item[$keys[$i - 65]]);\n                 $spreadsheet->getActiveSheet()->getColumnDimension(strtoupper(chr($i)))->setWidth(20); //固定列宽\n             }\n \n         }\n \n         header('Content-Type: application/vnd.ms-excel');\n         header('Content-Disposition: attachment;filename=\"' . $name . '.xlsx\"');\n         header('Cache-Control: max-age=0');\n         $writer = new Xlsx($spreadsheet);\n         $writer->save('php://output');\n \n         //删除清空：\n         $spreadsheet->disconnectWorksheets();\n         unset($spreadsheet);\n         exit;\n     }\n     public function outdataWithPriceTable($name='测试表', $data=[], $head=[], $keys=[])\n     {\n //        pd($data);\n         $count = count($head);  //计算表头数量\n \n         $spreadsheet = new Spreadsheet();\n         $sheet = $spreadsheet->getActiveSheet();\n \n         for ($i = 65; $i < $count + 65; $i++) {     //数字转字母从65开始，循环设置表头：\n //            if($i-65==10){\n //                $sheet->mergeCells('K1:L1')->setCellValue(strtoupper(chr($i)) . '1', $head[$i - 65]);\n //            }else{\n                 $sheet->setCellValue(strtoupper(chr($i)) . '1', $head[$i - 65]);\n //            }\n \n         }\n \n         /*--------------开始从数据库提取信息插入Excel表中------------------*/\n \n \n         foreach ($data as $key => $item) {             //循环设置单元格：\n             //$key+2,因为第一行是表头，所以写到表格时   从第二行开始写\n \n             for ($i = 65; $i < $count + 65; $i++) {     //数字转字母从65开始：\n                 if($i-65==10){\n                     $num=count($item[$keys[$i - 65]]);\n                     for($j=0;$j<$num;$j++){\n //                        $spreadsheet->getActiveSheet()->mergeCells(strtoupper(chr($i+$j+1)) . ($key + 2 ).':'.strtoupper(chr($i+$j+1)) . ($key + 2+(2*$num)));\n //                        $sheet->setCellValue(strtoupper(chr($i+$j+1)) . ($key + 2 ),$item[$keys[$i - 65]][$j]['number'] );\n                         $sheet->setCellValue(strtoupper(chr($i+$j+1)) . ($key + 2 ),$item[$keys[$i - 65]][$j]['number'].'x'.$item[$keys[$i - 65]][$j]['one_price']  );\n //                        $sheet->setCellValue(strtoupper(chr($i+$j+2)) . ($key + 2), 1);\n                     }\n //                    for($ii=0;$ii<$num;$ii++){\n ////                        $spreadsheet->getActiveSheet()->mergeCells(strtoupper(chr($i+$j+1)) . ($key + 2 ).':'.strtoupper(chr($i+$j+1)) . ($key + 2+(2*$num)));\n ////                        $sheet->setCellValue(strtoupper(chr($i+$j+1)) . ($key + 2 ),$item[$keys[$i - 65]][$j]['number'] );\n //                        $sheet->setCellValue(strtoupper(chr($i+$num+$ii+1)) . ($key + 2 ),$item[$keys[$i - 65]][$ii]['one_price'] );\n ////                        $sheet->setCellValue(strtoupper(chr($i+$j+2)) . ($key + 2), 1);\n //                    }\n                 }else{\n                     $sheet->setCellValue(strtoupper(chr($i)) . ($key + 2), $item[$keys[$i - 65]]);\n                     $spreadsheet->getActiveSheet()->getColumnDimension(strtoupper(chr($i)))->setWidth(20); //固定列宽\n                 }\n \n             }\n \n         }\n //        die;\n         header('Content-Type: application/vnd.ms-excel');\n         header('Content-Disposition: attachment;filename=\"' . $name . '.xlsx\"');\n         header('Cache-Control: max-age=0');\n         $writer = new Xlsx($spreadsheet);\n         $writer->save('php://output');\n \n         //删除清空：\n         $spreadsheet->disconnectWorksheets();\n         unset($spreadsheet);\n         exit;\n     }\n \n }\n```\n\n \n\n`备注`:这里的第一个方法是实现一个二维数组的导出的\n\n第二个方法是因为在这次的数据中需要处理阶梯价格,是一个一对多的关系,这里导出是按照阶梯价格排成横用x号拼接的\n\n#### 3. 导入\n\n视图层的代码\n\n```html\n {{include file=\"public/header\" /}}\n <form class=\"am-form am-form-horizontal\" action=\"{{:MyUrl('index/goods/upload')}}\" method=\"post\" enctype=\"multipart/form-data\">\n     <div class=\"am-form-group\">\n         <label for=\"fileToUpload\" class=\"am-u-sm-2 am-form-label \" >选择文件</label>\n         <div class=\"am-u-sm-10\">\n             <input type=\"file\" id=\"fileToUpload\" name=\"fileToUpload\" >\n <!--            <i class=\"am-icon-cloud-upload\"></i> 选择要上传的文件</button>-->\n             <p class=\"am-form-help\">请选择要上传的文件</p>\n         </div>\n     </div>\n     <div class=\"am-form-group\">\n         <div class=\"am-u-sm-10 am-u-sm-offset-2\">\n             <button type=\"submit\" class=\"am-btn am-btn-primary\" name=\"submit\">上传</button>\n         </div>\n     </div>\n </form>\n```\n\n控制层的代码\n\n`备注:`这里的代码还没有完善,还需要更新到数据库里面去\n\n```php\n public function upload(){\n         // 获取表单上传文件 例如上传了001.jpg\n         $file = request()->file('fileToUpload');\n         // 移动到框架应用根目录/uploads/ 目录下\n         $info = $file->move( '../public/static/xls');\n         if($info){\n             $spreadsheet = IOFactory::load($info->getPathName());\n             $sheetData = $spreadsheet->getActiveSheet()->toArray(null, true, true, true, true);\n             pd($sheetData);\n             //            $row_num = count($sheetData);\n //\n //            $now_time = time();\n //            $import_data = []; //数组形式获取表格数据\n //            //从第二行开始做for循环\n //            for ($i = 2; $i <= $row_num; $i++) {\n //                $bank_deal_no = $sheetData[$i]['A'];\n //                $account_name = $sheetData[$i]['B'];\n //                $bank_card = $sheetData[$i]['C'];\n //                $deal_money = $sheetData[$i]['D'];\n //                $deal_time = $sheetData[$i]['E'];\n //\n ////                if (!empty($bank_deal_no) && !empty($account_name) && !empty($bank_card) && !empty($deal_money) && !empty($deal_time)) {\n ////                    $import_data[$i]['bank_deal_no'] = $bank_deal_no;\n ////                    $import_data[$i]['account_name'] = $account_name;\n ////                    $import_data[$i]['bank_card'] = $bank_card;\n ////                    $import_data[$i]['deal_money'] = $deal_money;\n ////                    $import_data[$i]['deal_time'] = $deal_time;\n ////                    $import_data[$i]['create_time'] = $now_time;\n ////                    $import_data[$i]['update_time'] = $now_time;\n ////                }\n //            }\n //\n //            sort($import_data);\n //\n //            if (empty($import_data)) {\n //                return json(['status' => '1', 'message' => '数据解析失败']);\n //            }\n             // 成功上传后 获取上传信息\n             // 输出 jpg\n //            echo $info->getExtension();\n //            echo $info->getPathName();\n             // 输出 20160820/42a79759f284b767dfcb2a0197904287.jpg\n //            echo $info->getSaveName();\n             // 输出 42a79759f284b767dfcb2a0197904287.jpg\n //            echo $info->getFilename();\n         }else{\n             // 上传失败获取错误信息\n             echo $file->getError();\n         }\n     }\n```\n\n \n\n### 获取IP\n\n```PHP\n<?php\nfunction getIP()\n{\n  static $realip;\n  if (isset($_SERVER)){\n    if (isset($_SERVER[\"HTTP_X_FORWARDED_FOR\"])){\n      $realip = $_SERVER[\"HTTP_X_FORWARDED_FOR\"];\n    } else if (isset($_SERVER[\"HTTP_CLIENT_IP\"])) {\n      $realip = $_SERVER[\"HTTP_CLIENT_IP\"];\n    } else {\n      $realip = $_SERVER[\"REMOTE_ADDR\"];\n    }\n  } else {\n    if (getenv(\"HTTP_X_FORWARDED_FOR\")){\n      $realip = getenv(\"HTTP_X_FORWARDED_FOR\");\n    } else if (getenv(\"HTTP_CLIENT_IP\")) {\n      $realip = getenv(\"HTTP_CLIENT_IP\");\n    } else {\n      $realip = getenv(\"REMOTE_ADDR\");\n    }\n  }\n  return $realip;\n  echo $realip;\n}\necho getIP();\n?>\n```\n\n### 判断图片资源是否有效\n\n```php\n$url=config('shopxo.attachment_host').$value;\n$array = get_headers($url,1);\n\nif(preg_match('/200/',$array[0])){\n\treturn $url;\n}else{\n\treturn config('app.oss.path').$value;\n\t//echo \"无效url资源！\";\n}\t\n```\n\n### json_encode中文\n\n```php\n$file='./pay/notify'.date('YmdHis').'.txt';\nfile_put_contents($file, json_encode($ret,JSON_UNESCAPED_UNICODE), FILE_APPEND | LOCK_EX);\n```\n\n### php发送请求\n\n```php\n<?php\n// +----------------------------------------------------------------------\n// | CRMEB [ CRMEB赋能开发者，助力企业发展 ]\n// +----------------------------------------------------------------------\n// | Copyright (c) 2016~2020 https://www.crmeb.com All rights reserved.\n// +----------------------------------------------------------------------\n// | Licensed CRMEB并不是自由软件，未经许可不能去掉CRMEB相关版权\n// +----------------------------------------------------------------------\n// | Author: CRMEB Team <admin@crmeb.com>\n// +----------------------------------------------------------------------\n\nnamespace app\\service;\n\nclass HttpService\n{\n    /**\n     * 错误信息\n     * @var string\n     */\n    private static $curlError;\n\n    /**\n     * header头信息\n     * @var string\n     */\n    private static $headerStr;\n\n    /**\n     * 请求状态\n     * @var int\n     */\n    private static $status;\n\n    /**\n     * @return string\n     */\n    public static function getCurlError()\n    {\n        return self::$curlError;\n    }\n\n    /**\n     * @return mixed\n     */\n    public static function getStatus()\n    {\n        return self::$status;\n    }\n\n    /**\n     * 模拟GET发起请求\n     * @param $url\n     * @param array $data\n     * @param bool $header\n     * @param int $timeout\n     * @return bool|string\n     */\n    public static function getRequest($url, $data = array(), $header = false, $timeout = 10)\n    {\n        if (!empty($data)) {\n            $url .= (stripos($url, '?') === false ? '?' : '&');\n            $url .= (is_array($data) ? http_build_query($data) : $data);\n        }\n\n        return self::request($url, 'get', array(), $header, $timeout);\n    }\n\n    /**\n     * curl 请求\n     * @param $url\n     * @param string $method\n     * @param array $data\n     * @param bool $header\n     * @param int $timeout\n     * @return bool|string\n     */\n    public static function request($url, $method = 'get', $data = array(), $header = false, $timeout = 15)\n    {\n        self::$status = null;\n        self::$curlError = null;\n        self::$headerStr = null;\n\n        $curl = curl_init($url);\n        $method = strtoupper($method);\n        //请求方式\n        curl_setopt($curl, CURLOPT_CUSTOMREQUEST, $method);\n        //post请求\n        if ($method == 'POST') curl_setopt($curl, CURLOPT_POSTFIELDS, $data);\n        //超时时间\n        curl_setopt($curl, CURLOPT_TIMEOUT, $timeout);\n        //设置header头\n        if ($header !== false) curl_setopt($curl, CURLOPT_HTTPHEADER, $header);\n\n        curl_setopt($curl, CURLOPT_FAILONERROR, false);\n        //返回抓取数据\n        curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);\n        //输出header头信息\n        curl_setopt($curl, CURLOPT_HEADER, true);\n        //TRUE 时追踪句柄的请求字符串，从 PHP 5.1.3 开始可用。这个很关键，就是允许你查看请求header\n        curl_setopt($curl, CURLINFO_HEADER_OUT, true);\n        //https请求\n        if (1 == strpos(\"$\" . $url, \"https://\")) {\n            curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, false);\n            curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, false);\n        }\n        self::$curlError = curl_error($curl);\n\n        list($content, $status) = [curl_exec($curl), curl_getinfo($curl), curl_close($curl)];\n        self::$status = $status;\n        self::$headerStr = trim(substr($content, 0, $status['header_size']));\n        $content = trim(substr($content, $status['header_size']));\n        return (intval($status[\"http_code\"]) === 200) ? $content : false;\n    }\n\n    /**\n     * 模拟POST发起请求\n     * @param $url\n     * @param $data\n     * @param bool $header\n     * @param int $timeout\n     * @return bool|string\n     */\n    public static function postRequest($url, $data = array(), $header = false, $timeout = 10)\n    {\n        return self::request($url, 'post', $data, $header, $timeout);\n    }\n\n    /**\n     * 获取header头字符串类型\n     * @return mixed\n     */\n    public static function getHeaderStr()\n    {\n        return self::$headerStr;\n    }\n\n    /**\n     * 获取header头数组类型\n     * @return array\n     */\n    public static function getHeader()\n    {\n        $headArr = explode(\"\\r\\n\", self::$headerStr);\n        return $headArr;\n    }\n\n}\n\n\n使用:\n$res=HttpService::postRequest($this->url.$fun,[\"username\"=>$this->username,\"password\"=>$this->password]);\n```\n\n\n\n### phpstorm历史版本\n\n`https://www.jetbrains.com/phpstorm/download/other.html`\n\n### 压缩图片并保证清晰度\n\n```php\n<?php\n\n\nnamespace app\\common;\n\n\nclass Img\n{\n  private $src;\n  private $image;\n  private $imageinfo;\n  private $percent = 0.5;\n  /**\n   * 图片压缩\n   * @param $src 源图\n   * @param float $percent 压缩比例\n   */\n  public function __construct($src, $percent = 0.5)\n  {\n    $this->src = $src;\n    $this->percent = $percent;\n  }\n  /** 高清压缩图片\n   * @param string $saveName 提供图片名（可不带扩展名，用源图扩展名）用于保存。或不提供文件名直接显示\n   */\n  public function compressImg($saveName = '')\n  {\n    $this->_openImage();\n    if (!empty($saveName)) $this->_saveImage($saveName); //保存\n    else $this->_showImage();\n  }\n  /**\n   * 内部：打开图片\n   */\n  private function _openImage()\n  {\n    list($width, $height, $type, $attr) = getimagesize($this->src);\n    $this->imageinfo = array(\n      'width' => $width,\n      'height' => $height,\n      'type' => image_type_to_extension($type, false),\n      'attr' => $attr\n    );\n    $fun = \"imagecreatefrom\" . $this->imageinfo['type'];\n    $this->image = $fun($this->src);\n    $this->_thumpImage();\n  }\n  /**\n   * 内部：操作图片\n   */\n  private function _thumpImage()\n  {\n    $new_width = $this->imageinfo['width'] * $this->percent;\n    $new_height = $this->imageinfo['height'] * $this->percent;\n    $image_thump = imagecreatetruecolor($new_width, $new_height);\n    //将原图复制带图片载体上面，并且按照一定比例压缩,极大的保持了清晰度\n    imagecopyresampled($image_thump, $this->image, 0, 0, 0, 0, $new_width, $new_height, $this->imageinfo['width'], $this->imageinfo['height']);\n    imagedestroy($this->image);\n    $this->image = $image_thump;\n  }\n  /**\n   * 输出图片:保存图片则用saveImage()\n   */\n  private function _showImage()\n  {\n    header('Content-Type: image/' . $this->imageinfo['type']);\n    $funcs = \"image\" . $this->imageinfo['type'];\n    $funcs($this->image);\n  }\n  /**\n   * 保存图片到硬盘：\n   * @param string $dstImgName 、可指定字符串不带后缀的名称，使用源图扩展名 。、直接指定目标图片名带扩展名。\n   */\n  private function _saveImage($dstImgName)\n  {\n    if (empty($dstImgName)) return false;\n    $allowImgs = ['.jpg', '.jpeg', '.png', '.bmp', '.wbmp', '.gif'];  //如果目标图片名有后缀就用目标图片扩展名 后缀，如果没有，则用源图的扩展名\n    $dstExt = strrchr($dstImgName, \".\");\n    $sourseExt = strrchr($this->src, \".\");\n    if (!empty($dstExt)) $dstExt = strtolower($dstExt);\n    if (!empty($sourseExt)) $sourseExt = strtolower($sourseExt);\n    //有指定目标名扩展名\n    if (!empty($dstExt) && in_array($dstExt, $allowImgs)) {\n      $dstName = $dstImgName;\n    } elseif (!empty($sourseExt) && in_array($sourseExt, $allowImgs)) {\n      $dstName = $dstImgName . $sourseExt;\n    } else {\n      $dstName = $dstImgName . $this->imageinfo['type'];\n    }\n    $funcs = \"image\" . $this->imageinfo['type'];\n    $funcs($this->image, $dstName);\n  }\n  /**\n   * 销毁图片\n   */\n  public function __destruct()\n  {\n    imagedestroy($this->image);\n  }\n}\n$img = new Img(\"https://www.zcdz.com/public/static/upload/images/slide/2022/07/19/1658221420955468.png\", 0.5);\n$img->compressImg(\"banner7.png\");\n```\n\n### 批量更改数据库\n\n​\t\t\t\n\n```php\n//    public function goodsTime(){\n//        $i=0;\n//        while ($i<400){\n//            $list=Db::table(\"sxo_goods\")->field(\"id,goods_time\")->limit($i,100)->select();\n//            foreach ($list as $k=>$v){\n//                $tmp=explode(\"天\",$v[\"goods_time\"]);\n//                if(count($tmp)>1){\n//                    Db::table(\"sxo_goods\")->where(\"id\",$v[\"id\"])->update([\"goods_time\"=>$tmp[0].\"个工作日\"]);\n//                }\n//            }\n//            $i=$i+100;\n//        }\n//    }\n```\n\n```php\npublic function test(){\n        $goods=Db::name(\"GoodsSpecBase\")->limit(0,1700)->select();\n        foreach ($goods as $k=>$v){\n//            echo $v['goods_id'];\n            $info=Db::name(\"GoodsPrice\")->where(\"goods_id\",$v['goods_id'])->select();\n//            p($info);\n            if(count($info)>1){\n                $cmf_arr = array_column($info, 'price');\n                array_multisort($cmf_arr, SORT_ASC);\n                $data[\"price\"]=$cmf_arr[0];\n                Db::name('Goods')->where('id',$v['goods_id'])->update($data);\n                Db::name('GoodsSpecBase')->where('goods_id',$v['goods_id'])->update($data);\n            }\n        }\n    }\n```\n\n### thinkphp 5.1 \n\n#### 接收参数\n\n```php\n<?php\n//要用Request类 第一步就要引入他，才能在当前控制器上使用\n//知识点：use 与 namespace前面不可有空格等其他操作。\nnamespace app\\admin\\controller;\nuse think\\Request;\nclass Index{\n   \n   //  在index方法引入Request\n   public function index(Request $request){\n   \t// parma 表示接收所有传过来的参数 不管是post请求还是get请求 parma都能接收到参数\n   \t$data = $request->param();\n   \t// post表示只接收 post方式传出来的参数\n   \t$data1= $request->post();\n   \t// get表示只接收get方式传出来的参数\n   \t$data2= $request->get();\n   \t// 假如你只想拿到一个name值，这时我们可以在括号里面加上name即可。\n   \t$data = $request->param('name');\n   \t// 假如你只想拿到一个name值，而且还想给个默认值的话，这时我们可以在括号里面加上name后面加上即可。\n   \t$data = $request->param('name','这是默认值');\n   }\n}\n?>\n\n```\n\n#### 判断请求类型\n\n```php\n <?php\n//要用Request类 第一步就要引入他，才能在当前控制器上使用\n//知识点：use 与 namespace前面不可有空格等其他操作。\nnamespace app\\admin\\controller;\nuse think\\Request;\nclass Index{\n   //  在index方法引入Request\n   public function index(Request $request){\n   \t//判断请求类型是否为 post\n   \tif($request->isPost()){\n   \t\tdump('当前请求类型为post');\n   \t}\n   \t//判断请求类型是否为 get\n   \tif($request->isGet()){\n   \t\tdump('当前请求类型为get');\n   \t}\n   \t//判断请求类型是否为 Put\n   \tif($request->isPut()){\n   \t\tdump('当前请求类型为put');\n   \t}\n   \t//判断请求类型是否为 ajax\n   \tif($request->isAjax()){\n   \t\tdump('当前请求类型为ajax');\n   \t}\n   \t//判断请求类型是否是手机访问\n   \tif($request->isMobile()){\n   \t\tdump('当前请求类型为手机类型');\n   \t}\n   }\n}\n?>\n\n```\n\n### 去除字符串两端空格\n\n```php\n$str = \"  This is a string with spaces.  \";\n$trimmed = trim($str);\necho $trimmed; //输出：This is a string with spaces.\n\n//去除左边或者右边空格\n$str = \"   This is a string with spaces.   \";\n$leftTrimmed = ltrim($str);\n$rightTrimmed = rtrim($str);\necho $leftTrimmed; //输出：This is a string with spaces.\necho $rightTrimmed; //输出：   This is a string with spaces.\n```\n\n","tags":["php"],"categories":["php"]},{"title":"常用css操作","url":"/2023/11/22/常用css操作/","content":"\n### 文字图片禁止选中\n\n```css\n/* 防止文本选中 */\n.unselectable-text {\n  user-select: none;\n}\n \n/* 防止图片选中 */\n.unselectable-image {\n  user-drag: none;\n  user-select: none;\n}\n```\n\n### 截取文字\n\n```css\n<style>\n    .news-content p{\n        /*background: red;*/\n        display: -webkit-box;\n        -webkit-box-orient: vertical;\n        overflow: hidden;\n        -webkit-line-clamp: 2; /* 指定显示的行数 */\n        text-overflow: ellipsis; /* 使用省略号表示截取的部分 */\n    }\n    .news-content h3{\n        white-space: nowrap; /* 禁止换行 */\n        overflow: hidden; /* 隐藏溢出部分 */\n        text-overflow: ellipsis; /* 使用省略号表示截取的部分 */\n    }\n</style>\n```\n\n## 居中\n\n+ **1.使用flex布局**\n\n通过给父盒子添加display：flex属性（存在兼容性问题）\n\n```css\n.box1{\n   width: 200px;\n   height: 200px;\n   background-color: green;\n   display: flex;  \n   justify-content: center;       /*水平排列居中*/\n   /* align-items: center; */     /*竖直排列居中*/ \n}\n.box2{\n   background-color: pink;\n   width: 100px;\n   height: 100px;\n}\n\n\n```\n\n+ **2.margin：auto实现**\n\n```css\n* {\n  margin: 0;\n  padding: 0;\n}\n.div1 {\n  /* 如果父级有relative,则相对于父级盒子居中） */\n  position: relative;       \n  width: 400px;\n  height: 400px;\n  background-color: black;\n}\n.div2 {\n  position: absolute;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  width: 100px;\n  height: 100px;\n  background-color: red;\n  /* 水平居中 */\n  margin:  0 auto;     \n      \n  /* 垂直居中 */\n  /* margin: auto; */\n}\n```\n\n+ **3.通过transform实现**\n\n使用top:50%; left:50%;时，是以盒子的左上角为原点定位，是左上角的原点居中，但是元素本身并不居中。\n\ntransform：translate(-50%，-50%):分别向左向上移动自身长宽的50%，使其位于中心。\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n    }\n    .div1 {\n      position: absolute;\n      top: 50%;\n      left: 50%;\n      padding: 15px;\n      background-color: powderblue;\n      transform: translate(-50%,-50%);\n    }\n  </style>\n</head>\n<body>\n  <div class=\"div1\">\n    不知道高度\n  </div>\n</body>\n</html>\n```\n\n这个方法不需要知道高度，使用的是自身百分比\n\n+ **4.margin负间距**\n\n该方法高度类似于通过transform实现居中方法，但是需要知道盒子大小，才能进行最后两步的相对移位，transform方法因为使用的是自身百分比，故不须知道具体宽高\n\n```css\n    * {\n      margin: 0;\n      padding: 0;\n    }\n    .div {\n      position: absolute;\n      left: 50%;\n      top: 50%;\n      width: 200px;\n      height: 200px;\n      background-color: yellowgreen;\n      margin-left: -100px;\n      margin-top: -100px;\n    }\n```\n\n+ **5.tabel-cell**\n\n利用table-cell来控制垂直居中。\n\n```css\n    .box1 {\n      /* display: table-cell; */\n      /* vertical-align: middle; */\n      width: 600px;\n      height: 500px;\n      background-color: pink;\n    }\n    .box2 {\n      width: 200px;\n      height: 200px;\n      margin: 0 auto;\n      background-color: red;\n    }\n```\n\n+ **6.button居中**\n\n利用button做外容器，里边的块元素会自动垂直居中，只需要控制一下水平居中就可以达到效果。\n\n```css\n    button {\n      width: 400px;\n      height: 400px;\n      background-color: blueviolet;\n    }\n    div {\n      width: 150px;\n      height: 150px;\n      margin: 0 auto;\n      background-color: burlywood;\n    }\n```\n\n## 两栏布局（左侧固定宽度为200px，右侧自适应）\n\n```html\n<body>\n    <div class='wrap'>\n            <div class='left'>左侧固定内容</div>\n            <div class='right'>右侧自适应</div>\n    </div>\n</body>\n```\n\n### 1.使用浮动-float\n\n```css\n /*清除浏览器默认设置的边距*/\n * {\n    padding: 0;\n    margin: 0;\n   }\n    .wrap {\n        overflow: hidden;\n        border: 1px solid red;\n    }\n    /*脱离文档流*/\n   .left {\n        float: left;      //左边元素向左浮动\n        width: 200px;\n        height: 200px;\n        background: pink;\n    }\n    .right {\n        height: 200px;\n        background: skyblue;\n    }\n\n注：使用`float`会使元素脱离文档流，这样会导致两个div发生重叠，而在`.wrap`中设置`overflow: hidden`是为了触发BFC，清除浮动（不会重叠）。\n```\n\n### 2.使用绝对定位-absolute\n\n```css\n/*清除浏览器默认设置的边距*/\n* {\n    padding: 0;\n    margin: 0;\n}\n.wrap {\n    overflow: hidden;\n    position: relative;\n    border: 1px solid red;\n}\n/*脱离文档流*/\n.left {\n    position: absolute;   // 绝对定位\n    left: 0;\n    right: 0;\n    width: 200px;\n    height: 200px;\n    background: pink;\n}\n.right {\n    margin-left: 200px;    // 设置左边距和左边元素等宽\n    height: 200px;\n    background: skyblue;\n}\n\n注：这个实现方案要注意的是`.right`中设置`margin-left: 200px`，这里的200px是左边元素的宽。\n```\n\n###  3.使用弹性布局-flex\n\n```css\n/*清除浏览器默认设置的边距*/\n* {\n    padding: 0;\n    margin: 0;\n}\n.wrap {\n    display: flex;      // 弹性布局 \n    border: 1px solid red;\n}\n.left {\n    flex: 0 0 200px;   // 左边元素不扩大不缩小，默认宽度为200px\n    height: 200px;\n    background: purple;\n}\n.right {\n    flex: 1;          // 右边元素扩大，自动填充过多空间\n    height: 200px;\n    background: skyblue;\n}\n\n注：`flex`属性要在子元素上设置。`flex`属性是`flex-grow`（增长比例）和`flex-shrink`（缩小比例）和`flex-basis`（默认大小）的缩写。\n```\n\n### 4.使用表格布局-table\n\n```css\n/*清除浏览器默认设置的边距*/\n* {\n    padding: 0;\n    margin: 0;\n}\n.wrap {\n    display: table;      // 表格布局\n    border: 1px solid red;\n    width: 100%;\n}\n.left {\n    display:table-cell;  //设置这个元素为表单中的单元格\n    height: 200px;\n    width： 200px;\n    background: purple;\n}\n.right {\n    display:table-cell;  //设置这个元素为表单中的单元格\n    height: 200px;\n    background: skyblue;\n}\n注：表格布局按照我的理解是将父元素设置成一个表格，里面的元素都是一个一个单元格，可以设置几行几列，所以这个方法也可以实现三栏布局（一行三列）；可以设置行高列高。\n```\n\n### 5.使用网格布局-grid\n\n```scss\n/*清除浏览器默认设置的边距*/\n* {\n    padding: 0;\n    margin: 0;\n}\n.wrap {\n    display:grid;   // 网格布局\n    grid-template-rows: 200px;  // 设置行高\n    grid-template-columns: 200px auto;   // 设置列宽\n    border: 1px solid red;\n}\n.left {\n    background: purple;\n}\n.right {\n    background: skyblue;\n}\n注：`grid`布局真的太方便啦！！但是放在这里好像有点大材小用了\n```\n\n\n\n### 6.使用calc()函数\n\n```css\n/*清除浏览器默认设置的边距*/\n* {\n    padding: 0;\n    margin: 0;\n}\n.wrap {\n    overflow: hidden;\n    border: 1px solid red;\n}\n.left {\n    float: left;\n    background: purple;\n    height: 200px;\n    width: 200px;\n}\n.right {\n    background: skyblue;\n    height: 200px;\n    width: calc( 100% -200px )\n}\n```\n\n\n\n### 文字下划线样式\n\n```html\n<!DOCTYPE html>\n\n<html>\n\n<head>\n\n<meta charset=\"UTF-8\">\n\n<title>css 文字下划线样式</title>\n\n<style>\n\n.demo{\n\nwidth: 400px;\n\nheight: 400px;\n\nmargin:100px auto;\n\n}\n\n.demo1 span{\n\nborder-bottom: 1px solid #000000;\n\n}\n\n.demo2 span{\n\nborder-bottom: 5px solid #0081EF;\n\n}\n\n.demo3 span{\n\nborder-bottom: 2px dashed #000000;\n\n}\n\n.demo4 span{\n\nborder-bottom: 2px dotted #000000;\n\n}\n\n.demo5 span{\n\nborder-bottom: 5px double #000000;\n\n}\n\n</style>\n\n</head>\n\n<body>\n\n<div class=\"demo\">\n\n<p class=\"demo1\">这是第1段测试文字，<span>HTML中文网</span>！</p>\n\n<p class=\"demo2\">这是第2段测试文字，<span>HTML中文网</span>！</p>\n\n<p class=\"demo3\">这是第3段测试文字，<span>HTML中文网</span>！</p>\n\n<p class=\"demo4\">这是第4段测试文字，<span>HTML中文网</span>！</p>\n\n<p class=\"demo5\">这是第5段测试文字，<span>HTML中文网</span>！</p>\n\n</div>\n\n</body>\n\n</html>\n```\n\n### 浏览器地址显示自定义小图标\n\n```html\n在对应的html页面头部加上代码：\n\n<link rel=\"shortcut icon\" type=\"image/x-icon\" href=\"https://www.lanjiawang.com/assets/img/favicon.ico\" media=\"screen\" />\n完整示例如下：\n<head>\n    <link rel=\"shortcut icon\" type=\"image/x-icon\" href=\"https://www.lanjiawang.com/assets/img/favicon.ico\" media=\"screen\" />\n     <!--其他代码>\n</head>\n```\n\n","tags":["css"],"categories":["css"]},{"title":"常用js/jq操作","url":"/2023/11/22/常用js-jq操作/","content":"\n### input\n\n+ 根据name获取值:`$(\"input[name='spec_param']\").val();`\n\n### class\n\n+ 根据元素寻找其下子元素的长度:`$(\".body-list\").find(\".row-list\").length;`\n\n### click\n\n```javascript\n    $(\".add-spec\").on(\"click\",function(e){\n        console.log(total);\n    });\n```\n\n### select\n\n```javascript\nvar options=$(“#select option:selected”); //获取选中的项\n\nalert(options.val()); //拿到选中项的值\n\nalert(options.text()); //拿到选中项的文本\n\nalert(options.attr('url')); //拿到选中项的url值\n```\n\n\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n\t<title>Javascript中点击事件方法一</title>\n</head>\n<body>\n\t<button id=\"btn\">click</button>\n\t<script type=\"text/javascript\">\n\t\tvar btn = document.getElementById(\"btn\");\n\t\tbtn.οnclick=function(){\n\t\t\talert(\"hello world\");\n\t\t}\n\t</script>\n</body>\n</html>\n```\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n\t<title>Javascript中点击事件方法二</title>\n</head>\n<body>\n\t<button id=\"btn\">click</button>\n\t<script type=\"text/javascript\">\n\t\tvar btn = document.getElementById(\"btn\");\n\t\tbtn.addEventListener('click',function(){\n\t\t\talert(\"hello wrold\");\n\t\t},false)\n\t</script>\n</body>\n</html>\n```\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n\t<title>Javascript中点击事件方法三</title>\n\t<script type=\"text/javascript\">\n\t\tfunction test(){\n\t\t\talert(\"hello world\");\n\t\t}\n\t</script>\n</head>\n<body>\n\t<button id=\"btn\" οnclick=\"test()\">click</button>\n</body>\n</html>\n```\n\n\n\n### JQuery中获取JSON文件中的数据\n\n\n\n#### 1、使用 Ajax 方式获取\n\n```javascript\n$.get(\"json/test.json\", function(data) {\n     console.log(data.total);\n});\n\n另一种方式：\n$.ajax({\n     type: \"get\",\n     url: \"json/test.json\",\n     dataType: \"json\",\n     async: false,\n     success: function(data) {\n          console.log(data.total);\n     }\n});\n```\n\n#### 2、使用 getJSON 方式获取\n\n```javascript\n$.getJSON(\"json/test.json\", function(data)  {\n     console.log(data.total);\n})\n```\n\n\n以上方式获取到的数据都是 JSON 格式的数据，无需转换，即可使用\n\n\n\n### 利用百度翻译API翻译整个网站 \n\n首先,[百度翻译开放平台 (baidu.com)](https://fanyi-api.baidu.com/)申请appid和appkey\n\n```javascript\n<!doctype html>\n<head>\n    <meta charset=\"utf-8\" />\n</head>\n<body>\n    <div>测试\n        <div>橘子</div>\n    </div>\n    <div>梨</div>\n    <div>测试</div>\n    <div>零食</div>\n    <div>水果</div>\n    <div>上班</div>\n    <script src=\"https://code.jquery.com/jquery-3.6.0.min.js\"></script>\n    <script src=\"http://cdn.bootcss.com/crypto-js/3.1.2/rollups/md5.js\"></script>\n    <script type=\"text/javascript\">\n        transformLanguage('jp');\n        var newLanguage='jp';\n        function transformLanguage(newLanguage) {\n            // 获取所有dom元素中文\n            let transformStr = '';\n            // 获取所有dom元素\n            function getChildDom(dom, type, data = {}) {\n                if(type == 'read') {\n                    [...dom.children].forEach(v => {\n                        // 判断中文\n                        // /^[\\u0391-\\uFFE5]+$/\n                        let re= /[\\u4e00-\\u9fa5]/g;\n                        // 防止某些标签有内容并且有标签 ，或者有空格 \n                        let vHtml = $(v).contents().filter(function (index, content) {return content.nodeType === 3}).text().trim();\n                        // 跳过script标签\n                        if (re.test(vHtml) && v.tagName != 'SCRIPT') {\n                            transformStr += `${vHtml},`\n                        }\n                        // 递归获取元素\n                        getChildDom(v, type, data);\n                    })\n                }else {\n                    // console.log(newLanguage)\n                    let transOld = data.trans_result[0].src.split(',');\n                    let transNew;\n                    if(newLanguage=='jp'){\n                         transNew= data.trans_result[0].dst.split('、');\n                    }else{\n                        transNew = data.trans_result[0].dst.split(',');\n                    }\n                    \n                    \n                    \n                    [...dom.children].forEach(v => {\n                        // 判断中文\n                        // /^[\\u0391-\\uFFE5]+$/\n                        let re= /[\\u4e00-\\u9fa5]/g;\n                        let vHtml = $(v).contents().filter(function (index, content) {return content.nodeType === 3}).text().trim();\n                        // 跳过script标签\n                        if (re.test(vHtml) && v.tagName != 'SCRIPT') {\n                            // 防止标签里面还有标签，所以只替换里面的html,使用replace\n                            $(v).html(\n                                $(v).html().replace(\n                                transOld[transOld.findIndex(arrList => arrList == vHtml)]\n                                ,\n                                transNew[transOld.findIndex(arrList => arrList == vHtml)]\n                                )\n                            )\n                        }\n                        // 递归获取元素\n                        getChildDom(v, type, data);\n                    })\n                }\n            }\n            getChildDom(document,'read');\n            getTranslateData();\n            // 获取翻译\n            function getTranslateData() {\n                let appid = '20230504001665207';   // 百度翻译API的appid\n                let key = 'ACpxP4hjSwO88bJSL0iN';   // 百度翻译API的key\n                let salt = (new Date).getTime();\n                let query = transformStr;\n                let from = 'zh';\n                let to = newLanguage;\n                let str1 = appid + query + salt + key;\n                let sign = CryptoJS.MD5(str1).toString();\n                $.ajax({\n                    url: 'http://api.fanyi.baidu.com/api/trans/vip/translate',\n                    type: 'get',\n                    dataType: 'jsonp',\n                    data: {\n                        q: query,\n                        appid: appid,\n                        salt: salt,\n                        from: from,\n                        to: to,\n                        sign: sign\n                    },\n                    success: function(data) {\n                        data.trans_result && getChildDom(document,'write',data);\n                        console.log(data);\n                    }\n                });\n            }\n        }\n    </script>\n</body>\n```\n\n就可以翻译了\n\n \n\n在此期间遇到两个问题:\n\n1：翻译日语的时候会在页面上显示undefined,是因为日语的翻译后语言是以、分隔的,所以在处理日语的时候需要按照语言判断\n\n2：在方法的方法里面访问外部变量会找不到变量，解决，把变量变成全局变量\n\n### 添加HTML代码\n\n```javascript\n$(\".demo\").html(\"<span></span>\")\n```\n\n```javascript\nvar $span=$(\"<span></span>\");\n$(\".demo\").append($span);\n```\n\n### ajax封装\n\n```javascript\n//页面加载所要进行的操作\n$(function () {\n    //设置ajax当前状态(是否可以发送);\n    ajaxStatus = true;\n});\n\n// ajax封装\nfunction ajax(url, data, success, cache, alone, async, type, dataType, error) {\n    var type = type || 'post';//请求类型\n    var dataType = dataType || 'json';//接收数据类型\n    var async = async || true;//异步请求\n    var alone = alone || false;//独立提交（一次有效的提交）\n    var cache = cache || false;//浏览器历史缓存\n    var success = success || function (data) {\n            /*console.log('请求成功');*/\n            setTimeout(function () {\n                layer.msg(data.msg);//通过layer插件来进行提示信息\n            },500);\n            if(data.status){//服务器处理成功\n                setTimeout(function () {\n                    if(data.url){\n                        location.replace(data.url);\n                    }else{\n                        location.reload(true);\n                    }\n                },1500);\n            }else{//服务器处理失败\n                if(alone){//改变ajax提交状态\n                    ajaxStatus = true;\n                }\n            }\n        };\n    var error = error || function (data) {\n            /*console.error('请求成功失败');*/\n            /*data.status;//错误状态吗*/\n            layer.closeAll('loading');\n            setTimeout(function () {\n                if(data.status == 404){\n                    layer.msg('请求失败，请求未找到');\n                }else if(data.status == 503){\n                    layer.msg('请求失败，服务器内部错误');\n                }else {\n                    layer.msg('请求失败,网络连接超时');\n                }\n                ajaxStatus = true;\n            },500);\n        };\n    /*判断是否可以发送请求*/\n    if(!ajaxStatus){\n        return false;\n    }\n    ajaxStatus = false;//禁用ajax请求\n    /*正常情况下1秒后可以再次多个异步请求，为true时只可以有一次有效请求（例如添加数据）*/\n    if(!alone){\n        setTimeout(function () {\n            ajaxStatus = true;\n        },1000);\n    }\n    $.ajax({\n        'url': url,\n        'data': data,\n        'type': type,\n        'dataType': dataType,\n        'async': async,\n        'success': success,\n        'error': error,\n        'jsonpCallback': 'jsonp' + (new Date()).valueOf().toString().substr(-4),\n        'beforeSend': function () {\n            layer.msg('加载中', {通过layer插件来进行提示正在加载\n                icon: 16,\n                shade: 0.01\n            });\n        },\n    });\n}\n\n// submitAjax(post方式提交)\nfunction submitAjax(form, success, cache, alone) {\n    cache = cache || true;\n    var form = $(form);\n    var url = form.attr('action');\n    var data = form.serialize();\n    ajax(url, data, success, cache, alone, false, 'post','json');\n}\n/*//调用实例\n$(function () {\n    $('#form-login').submit(function () {\n        submitAjax('#form-login');\n        return false;\n    });\n});*/\n\n// ajax提交(post方式提交)\nfunction post(url, data, success, cache, alone) {\n    ajax(url, data, success, cache, alone, false, 'post','json');\n}\n\n// ajax提交(get方式提交)\nfunction get(url, success, cache, alone) {\n    ajax(url, {}, success, alone, false, 'get','json');\n}\n\n// jsonp跨域请求(get方式提交)\nfunction jsonp(url, success, cache, alone) {\n    ajax(url, {}, success, cache, alone, false, 'get','jsonp');\n}\n```\n\n","tags":["js","jq"],"categories":["js/jq"]},{"title":"Hexo主题 —— NexT优化","url":"/2023/11/20/Hexo主题-NexT优化/","content":"# Hexo主题 —— NexT优化\n\n首先，必须要说明的是，关于NexT主题的所有设置与功能都能在[《NexT主题官方文档》](https://link.juejin.cn?target=http%3A%2F%2Ftheme-next.iissnan.com%2Fgetting-started.html)中找到。本文只是记录下我采用的设置。\n\n------\n\n## 主题配置文件_config.yaml\n\nHexo安装根目录下的`_config.yaml`文件负责的是整个Hexo的属性配置，而主题目录下也有`/theme/_config.yaml`文件，负责单个主题的属性配置，NexT主题的配置文件就在`Hexo/themes/next/`目录下。\n\n------\n\n## Scheme主题选择\n\n在`theme/_config.yaml`文件中的`scheme`目录下选择自己喜欢的主题即可。\n **Muse** 是NexT的默认版本，黑白主调，大量留白。\n\n![Muse](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b0730a70749019~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n\n\n**Mist** 是NexT的紧凑版本，整洁有序。\n\n![Mist](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b0730a7351d33b~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n\n\n**Pisces** 是双栏设计，头像、签名等被移到左边单独作为一栏，个人最喜欢。\n\n![Pisces](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b0730a7363ffa8~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n\n\n------\n\n## 文内链接形式\n\n未修改时，文内链接颜色和普通文本没有区别：\n\n![link origin](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b0730a73672f51~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n\n 为了突出区别性，我们在`themes/next/source/css/_common/components/post/post.styl`文件中添加下列的代码：\n\n\n\n```\n复制代码  .post-body p a {\n    color: #0593d3;\n    border-bottom: none;\n    border-bottom: 1px solid #0593d3;\n    &:hover {\n      color: #fc6423;\n      border-bottom: none;\n      border-bottom: 1px solid #fc6423;\n    }\n  }\n```\n\n修改后的文内链接是蓝色，鼠标放上去会变为红色：\n\n![link new](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b0730a738f1237~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n\n\n------\n\n## 菜单设置\n\n在`theme/_config.yaml`文件中的`menu`目录下：`home`属性代表主页，`about`属性代表个人信息，`tags`属性代表标签，`categories`属性代表目录，`archives`属性代表归档…… 通过修改对应的属性，可以修改页面的展示信息，即左侧的菜单栏：\n\n![menu](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b0730a73bf0e6b~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n\n\n------\n\n## 网站图标设置\n\n将图片（png或jpg格式，不是favicon.ico）放在`themes/next/source/images`里，然后修改主题配置文件`theme/_config.yaml`的`favicon`属性，将`small`、`medium`和`apple_touch_icon`都配置为`/images/imgPath`就可以了，其他字段都注释掉。\n\n```\n复制代码favicon:\n  small: /images/db3.png\n  medium: /images/db3.png\n  apple_touch_icon: /images/db3.png\n```\n\n------\n\n## 启用RSS订阅博客更新\n\n> 什么是RSS？\n>  RSS(Really Simple Syndication，简易信息聚合)是一种描述和同步网站内容的格式，是使用最广泛的XML应用。RSS搭建了信息迅速传播的一个技术平台，使得每个人都成为潜在的信息提供者。发布一个RSS文件后，这个RSS Feed中包含的信息就能直接被其他站点调用，而且由于这些数据都是标准的XML格式，所以也能在其他的终端和服务中使用，是一种描述和同步网站内容的格式。\n>  RSS目前广泛用于网上新闻频道，blog和wiki，主要的版本有0.91, 1.0, 2.0。使用RSS订阅能更快地获取信息，网站提供RSS输出，有利于让用户获取网站内容的最新更新。网络用户可以在客户端借助于支持RSS的聚合工具软件，在不打开网站内容页面的情况下阅读支持RSS输出的网站内容。\n\n1. 安装`hexo-generator-feed`插件\n    `npm install hexo-generator-feed --save`\n2. 在站点的配置文件`_config.yaml`文件中配置RSS feed\n    在`_config.yaml`文件末尾添加：\n\n```\n复制代码 feed:  \n type: atom  \n path: atom.xml  \n limit: 0  \n\n plugins:\n   - hexo-generator-feed\n```\n\n1. 修改主题配置文件`theme/_config.yaml`的rss属性为：`rss: /atom.xml`\n2. 使用RSS\n\n运行`hexo g`，如果提示`INFO Generated: atom.xml`，且在`Hexo/public/`目录下生成了`atom.xml`文件，则说明RSS设置成功。\n 运行`hexo d`，如果服务器对应的目录`hexo`下也有了`atom.xml`文件，则说明部署也成功了。\n 这样你的博客就可以被别人订阅了，点击主页的RSS按钮，会显示如下页面：\n\n![RSS](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b0730b45485959~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n\n\n------\n\n## 打赏\n\n在`theme/_config.yaml`文件中的`Reward(Donate)`目录下，传入打赏图片，可以展示打赏信息：\n\n```\n复制代码  # Reward (Donate)\n  reward_settings:\n    enable: true\n    animation: true\n    comment: 没办法，要恰饭的嘛\n  reward:\n    wechatpay: https://tva1.sinaimg.cn/large/007rAy9hgy1g3b8vqnvnrj30u014q0w6.jpg\n    alipay: https://tva1.sinaimg.cn/large/007rAy9hgy1g3b8wjrpzgj30p011iaco.jpg\n```\n\n------\n\n## 首页文章折叠\n\n将`theme/_config.yaml`文件`auto_excerpt`目录下的`enable`改为true即可。\n\n![auto_excerpt](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b0730b4555e0bd~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n\n\n------\n\n## 回到顶部按钮显示百分比\n\n```\n复制代码back2top:\n  # 回到顶部按钮\n  enable: true\n  # true，按钮显示在侧边栏；false，按钮显示在右下角\n  sidebar: false\n  # 按钮上显示百分比\n  scrollpercent: true\n```\n\n如图：\n\n![back2top](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b0730b48279625~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n\n\n------\n\n## 文章添加阴影\n\n未添加阴影时，文章之间的分隔不是很明显：\n\n![no shadow](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b0730b4f5e84dd~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n\n 在`themes/next/source/css/_custom/custom.styl`文件中添加如下代码：\n\n\n\n```\n复制代码// Custom styles.\n// 为文章添加阴影效果\n.post {\n   margin-top: 60px;\n   margin-bottom: 60px;\n   padding: 25px;\n   -webkit-box-shadow: 0 0 5px rgba(202, 203, 203, .5);\n   -moz-box-shadow: 0 0 5px rgba(202, 203, 204, .5);\n}\n```\n\n效果如图：\n\n![shadow](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b0730b5b86a4e7~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n\n\n------\n\n## 头像\n\n修改`theme/_config.yaml`文件下的`avatar`属性，可以使用本地图片，或是在`avatar: url:`属性中传入网络图片。\n\n------\n\n## 社交链接\n\n修改`theme/_config.yaml`文件下的`social`属性，按照格式设置即可：\n\n```\n复制代码  social:\n    GitHub: https://github.com/DragonBaby308 || github\n    Bilibili: https://space.bilibili.com/24837083 || bilibili\n```\n\n------\n\n## 友情链接\n\n修改`theme/_config.yaml`文件下的`links`属性，按照格式设置即可：\n\n```\n复制代码links:\n  让我帮你百度一下: http://lab.mkblog.cn/lmbtfy/\n```\n\n------\n\n## Local Search本地搜索\n\n1. 首先，安装`hexo-generator-searchdb`，在根目录下执行：\n    `npm install -g hexo-generator-searchdb --save`\n2. 在站点配置文件`_config.yaml`中添加如下内容：\n\n```\n复制代码search:\n  path: ./public/search.xml\n  field: post\n  format: html\n  limit: 10000\n```\n\n1. 将主题配置文件\n\n   ```\n   theme/_config.yaml\n   ```\n\n   文件中\n\n   ```\n   local_search\n   ```\n\n   标签下的\n\n   ```\n   enable\n   ```\n\n   改为true。\n\n   ![Local Search](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b0730b8205d551~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n------\n\n## 不蒜子统计UV（访客数）和PV（访问量）\n\n将主题配置文件`theme/_config.yaml`文件中`busuanzi_count`标签下的`enable`改为true。配置如下：\n\n```\n复制代码busuanzi_count:\n  enable: true\n  # 访客数\n  site_uv: true\n  # 访问量\n  site_pv: true\n  # 文章阅读次数\n  page_pv: true\n```\n\n------\n\n## 动态背景\n\n首先将动态背景所需要依赖的js下载到`themes/next/source/lib`目录下，然后将主题配置文件`theme/_config.yaml`文件中`canvas`标签下的对应特效改为true即可启用。 如，我需要使用`Canvas-nest`动画，则需要首先`git clone https://github.com/theme-next/theme-next-canvas-nest Hexo/themes/next/source/lib/canvas-nest`，将js下载到本地，然后再修改主题配置文件`theme/_config.yaml`文件中`canvas_nest`标签下的`enable`为true。\n\n```\n复制代码# canvas-nest  鼠标静止不动，会有线条聚集\ngit clone https://github.com/theme-next/theme-next-canvas-nest Hexo/themes/next/source/lib/canvas-next\n\n# three_waves  波浪\n# canvas_lines\n# canvas_sphere\ngit clone https://github.com/theme-next/theme-next-three Hexo/themes/next/source/lib/next-three\n\n# canvas-ribbon  彩虹效果，只支持Pisces\ngit clone https://github.com/theme-next/theme-next-canvas-ribbon Hexo/themes/next/source/lib/canvas-ribbon\n\ncanvas_nest:\n  enable: true\n  onmobile: true # display on mobile or not\n  color: \"0,0,255\" # RGB values, use ',' to separate\n  opacity: 0.5 # the opacity of line: 0~1\n  zIndex: -1 # z-index property of the background\n  count: 99 # the number of lines\n\nthree_waves: true\ncanvas_lines: true\ncanvas_sphere: true\n\ncanvas_ribbon:\n  enable: true\n  size: 300\n  alpha: 0.6\n  zIndex: -1\n```\n\n------\n\n## 加载条效果\n\n首先通过`git clone https://github.com/theme-next/theme-next-pace Hexo/themes/next/source/lib/page`命令，将加载条所需要依赖的js下载到`Hexo/themes/next/source/lib`目录下，然后将主题配置文件`theme/_config.yaml`文件中`pace`标签改为true，在`pace_theme`中选用对应主题即可启用。\n\n```\n复制代码pace: true\n# pace_theme: pace-theme-big-counter  右上角百分比数字\n# pace_theme: pace-theme-bounce  右上角弹球\n# pace_theme: pace-theme-barber-shop  理发店蓝白加载条，从左滑到右\n# pace_theme: pace-theme-center-atom  屏幕正中，原子样式的圆形加载条\n# pace_theme: pace-theme-center-circle  屏幕正中，圆形转圈加载条\n# pace_theme: pace-theme-center-radar  屏幕正中，雷达形状\n# pace_theme: pace-theme-center-simple  屏幕正中，进度条\n# pace_theme: pace-theme-corner-indicator  右上角转圈\n# pace_theme: pace-theme-fill-left  从左到右\n# pace_theme: pace-theme-flash  右上角有一个小圈圈，其他特效没看出来\n# 屏幕正中间进度条\npace_theme: pace-theme-loading-bar  \n# pace_theme: pace-theme-mac-osx  斑马纹？\n# pace_theme: pace-theme-minimal  啥也没有\n```\n\n------\n\n## 本文结束标记\n\n在`themes/next/layout/_macro`目录下新建`passage-end-tag.swig`文件，添加以下代码：\n\n```\n复制代码<div>\n    {% if not is_index %}\n        <div style=\"text-align:center;color: #ccc;font-size:14px;\">-------------本文结束<i class=\"fa fa-paw\"></i>感谢您的阅读-------------</div>\n    {% endif %}\n</div>\n```\n\n接着在`themes/next/layout/_macro/post.swig`文件中，`post-body`后，添加如下代码：\n\n```\n复制代码<div>\n  {% if not is_index %}\n    {% include 'passage-end-tag.swig' %}\n  {% endif %}\n</div>\n```\n\n最后在`theme/_config.yaml`文件末尾添加：\n\n```\n复制代码# 文章末尾添加“本文结束”标记\npassage_end_tag:\n  enabled: true\n```\n\n效果如图：\n\n![pageend](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b0730b8ea536b2~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n\n\n------\n\n## 版权声明\n\n1. 在`theme/next/layout/_macro/`目录下添加文件`my-copyright.swig`\n\n```\n复制代码{% if page.copyright %}\n<div class=\"my_post_copyright\">\n  <script src=\"//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js\"></script>\n\n  <!-- JS库 sweetalert 可修改路径 -->\n  <script src=\"https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js\"></script>\n  <script src=\"https://unpkg.com/sweetalert/dist/sweetalert.min.js\"></script>\n  <p><span>本文标题:</span><a href=\"{{ url_for(page.path) }}\">{{ page.title }}</a></p>\n  <p><span>文章作者:</span><a href=\"/\" title=\"访问 {{ theme.author }} 的个人博客\">{{ theme.author }}</a></p>\n  <p><span>发布时间:</span>{{ page.date.format(\"YYYY年MM月DD日 - HH:mm\") }}</p>\n  <p><span>最后更新:</span>{{ page.updated.format(\"YYYY年MM月DD日 - HH:mm\") }}</p>\n  <p><span>原始链接:</span><a href=\"{{ url_for(page.path) }}\" title=\"{{ page.title }}\">{{ page.permalink }}</a>\n    <span class=\"copy-path\"  title=\"点击复制文章链接\"><i class=\"fa fa-clipboard\" data-clipboard-text=\"{{ page.permalink }}\"  aria-label=\"复制成功！\"></i></span>\n  </p>\n  <p><span>许可协议:</span><i class=\"fa fa-creative-commons\"></i> <a rel=\"license\" href=\"https://creativecommons.org/licenses/by-nc-nd/4.0/\" target=\"_blank\" title=\"Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)\">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>  \n</div>\n<script>\n    var clipboard = new Clipboard('.fa-clipboard');\n      $(\".fa-clipboard\").click(function(){\n      clipboard.on('success', function(){\n        swal({   \n          title: \"\",   \n          text: '复制成功',\n          icon: \"success\",\n          showConfirmButton: true\n          });\n        });\n    });  \n</script>\n{% endif %}\n```\n\n1. 在`theme/next/source/css/_common/components/post/`目录下添加文件`my-post-copyright.styl`\n\n```\n复制代码.my_post_copyright {\n  width: 85%;\n  max-width: 45em;\n  margin: 2.8em auto 0;\n  padding: 0.5em 1.0em;\n  border: 1px solid #d3d3d3;\n  font-size: 0.93rem;\n  line-height: 1.6em;\n  word-break: break-all;\n  background: rgba(255,255,255,0.4);\n}\n.my_post_copyright p{margin:0;}\n.my_post_copyright span {\n  display: inline-block;\n  width: 5.2em;\n  color: #b5b5b5;\n  font-weight: bold;\n}\n.my_post_copyright .raw {\n  margin-left: 1em;\n  width: 5em;\n}\n.my_post_copyright a {\n  color: #808080;\n  border-bottom:0;\n}\n.my_post_copyright a:hover {\n  color: #a3d2a3;\n  text-decoration: underline;\n}\n.my_post_copyright:hover .fa-clipboard {\n  color: #000;\n}\n.my_post_copyright .post-url:hover {\n  font-weight: normal;\n}\n.my_post_copyright .copy-path {\n  margin-left: 1em;\n  width: 1em;\n  +mobile(){display:none;}\n}\n.my_post_copyright .copy-path:hover {\n  color: #808080;\n  cursor: pointer;\n}\n```\n\n1. 修改`theme/next/layout/_macro/post.swig`文件\n\n```\n复制代码{#####################}\n{### END POST BODY ###}\n{#####################}\n\n  # 添加下面这段\n{% if not is_index %}\n  {% include 'my-copyright.swig' %}\n{% endif %}\n\n{% if theme.wechat_subscriber.enable and not is_index %}\n  {% include '../_partials/post/wechat-subscriber.swig' %}\n{% endif %}\n```\n\n1. 修改`theme/next/source/css/_common/components/post/post.styl`文件，在最后一行新增：`@import \"my-post-copyright\";`\n2. 修改`Hexo/scaffolds/post.md`，默认显示版权信息\n\n```\n复制代码---\ntitle: {{ title }}\ndate: {{ date }}\ntags:\ncategories:\ncopyright:\n---\n```\n\n效果如图：\n\n![copyright](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b0730ba695cf7a~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n\n\n------\n\n## Livere（来必力）评论区\n\n首先，访问[Livere官网](https://link.juejin.cn?target=https%3A%2F%2Flivere.com%2Finsight%2FmyCode)，注册→登录→安装，会得到一个`data-id`。\n\n![data-id](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b0730bbb0dc2f6~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n将`data-id`复制粘贴到`theme/_config.yaml`文件的`livere_uid`属性即可。效果如图：\n\n![Livere](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b0730bcd06c639~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n\n\n------\n\n## Live2d 看板娘\n\n1. 安装hexo-helper-live2d\n\n在博客根目录下，执行`npm install hexo-helper-live2d --save`\n\n1. 修改站点配置文件或主题配置文件\n\n官方已有的看板娘名称请点[这里](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiazeyu%2Flive2d-widget-models)查看，部分看板娘的模型预览请看[CSDN某博客](https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fwang_123_zy%2Farticle%2Fdetails%2F87181892)。\n 我修改的是站点配置文件`Hexo/_config.yaml`，添加如下代码：\n\n```\n复制代码live2d:\n  enable: true\n  scriptFrom: local\n  pluginRootPath: live2dw/\n  pluginJsPath: lib/\n  pluginModelPath: assets/\n  model:\n    # 填写你所需要的看板娘名称\n    use: live2d-widget-model-haruto\n  display:\n    position: right\n    width: 150\n    height: 300\n  mobile:\n    show: true\n```\n\n1. 通过npm安装依赖的看板娘文件\n\n`npm install live2d-widget-model-name`，其中`name`是你选择的官方看板娘的名字，如我选择的是`haruto`，则为`npm install live2d-widget-model-haruto`。\n 重新运行`hexo clean && hexo d -g`则可在主页看到了。\n\n![haruto](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b0730bde1a76a1~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n\n\n作者：DragonBaby308\n链接：https://juejin.cn/post/6844903856577626119\n来源：稀土掘金\n著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。\n\n","tags":["hexo","主题"],"categories":["hexo"]},{"title":"Hexo博客搭建与部署","url":"/2023/11/20/Hexo博客搭建与部署/","content":"\n### [Hexo](https://hexo.io/zh-cn/index.html)简介\n\nHexo是一款基于[Node](https://so.csdn.net/so/search?q=Node&spm=1001.2101.3001.7020).js的静态博客框架，使用Markdown（或其他渲染引擎）解析文章，依赖少易于安装，可在几秒内利用现有主题生成静态网页。框架提供了很详细的中文文档，大家可以进入[Hexo官网](https://hexo.io/zh-cn/)查看。\n\n### 环境准备\n\n#### 安装Git\n\nGit是一个先进的分布式版本控制工具，可以有效处理不同规模的项目版本管理。这里用于管理你的Hexo文章，将本地的博客上传至[Github](https://so.csdn.net/so/search?q=Github&spm=1001.2101.3001.7020)。到Git官网选择合适的版本[下载](https://gitforwindows.org/)，安装后会有一个Git Bash的命令行工具，之后用该工具操作Git。\n\n检查是否安装成功：\n\n```bash\ngit --version\n```\n\n正常显示版本号，无报错即为安装成功。\n\n#### 安装Node.js\n\nHexo基于Node.js，所以需要安装Node.js及npm工具。可进入Node.js中文网[下载](http://nodejs.cn/download/)，选择LTS（长期支持版本）即可。\n\n检查是否安装成功：\n\n```bash\nnode -v\nnpm -v\n```\n\n### 博客本地搭建\n\n#### 安装Hexo\n\n右键打开Git Bash，输入命令：\n\n```bash\nnpm install -g hexo-cli\n\nhexo -v\n```\n\n#### 初始化博客\n\n```bash\nhexo init myblog\ncd myblog\nnpm install\n```\n\n#### 博客本地效果\n\nGit Bash执行以下命令：\n\n```bash\nhexo -g\nhexo server\n```\n\n启动hexo服务，访问[http://localhost:4000](http://localhost:4000/)即可看到生成的博客页面。使用Ctrl+C可关闭本地服务。\n\n### 博客Github部署\n\n#### 创建个人仓库\n\n这里需要Github账号，如果没有可以去[注册](https://github.com/join)一个。\n\n[登录](https://github.com/login)Github，新建一个仓库，命名格式为：用户名.github.io。比如，我的用户名是muzihuaner，我的仓库名为muzihuaner.github.io`。注意这里必须按此格式命名，只有这样，之后部署到GitHub pages的时候，才会被识别。\n\n登录Github，新建一个仓库，命名格式为：用户名.github.io。比如，我的用户名是muzihuaner，我的仓库名为muzihuaner.github.io`。注意这里必须按此格式命名，只有这样，之后部署到GitHub pages的时候，才会被识别。\n\n#### 配置SSH\n\n打开Git Bash，输入以下命令，生成本地密钥。这里用户名和邮箱仅作演示，用户名为你Github的用户名，邮箱为你Github的邮箱。\n\n```bash\ngit config --global user.name \"shirllyz\"\ngit config --global user.email \"1107995569@qq.com\"\n```\n\n输入以下命令，检查输入是否正确：\n\n```bash\ngit config user.name\ngit config user.email\n```\n\n确认无误后，输入以下命令，创建SSH：\n\n```bash\nssh-keygen -t rsa -C \"youremail\"\n```\n\n无脑下一步即可\n\n此时在用户文件夹下，已经生成了.ssh文件夹，在本地找到这个文件夹。\n\n\n\nid_rsa是你这台电脑的私人秘钥，id_rsa.pub是公共秘钥。把公钥放在GitHub上，当你连接自己的Github账号时，它就会根据公钥匹配你的私钥，当能够相互匹配时，才能够顺利的通过Git上传你的文件到GitHub上。\n\n在Github的设置中，找到SSH and GPG keys，新建SSH Key，以文本方式打开id_rsa.pub文件，将内容复制到Key，标题随便起，添加Key。\n\n\n\n部署代码到Github\n打开站点配置文件_config.yml，拉到最底部，找到deploy字段，按如下格式修改其内容：\n\n```bash\ndeploy:\n  type: git\n  repository: git@github.com:shirllyz/shirllyz.github.io.git\n  branch: main\n```\n\n其中repo字段可在Github获取：\n\n\n\n回到Git Bash，安装deploy-git ，用于使用命令部署到Github。\n\n```bash\nnpm install hexo-deployer-git --save\n```\n\n然后执行：\n\n```bash\nhexo clean\t//可省略\nhexo generate\nhexo deploy出现下图所示说明部署成功，此时代码已同步至Github。\n```\n\n打开网址`shirllyz.github.io`就可以看到Hexo博客了。\n\n常用命令\nHexo文档中命令很多，但你并不需要记住每一个。在博客的使用过程中，主要的命令如下：\n\n```bash\ninit用于新建网站\n\nhexo init <folder>\n\nnew用于新建文章或页面\n\nhexo new [layout] <title>\n\ngenerate用于生成静态页面\n\nhexo generate\nhexo g\t//简写\n\ndeploy用于将内容部署到网站\n\nhexo deploy\nhexo -g\n\npublish用于将内容从drafts文件夹移动到posts文件夹\n\nhexo publish [layout] <title>\n\nserver用于启动服务器进行预览，默认情况下，访问入口为http://localhost:4000/\n\nhexo server\nhexo s\t//简写\n\n实际上，除了第一次部署时，需要用到hexo init这个命令，平时写博客的过程中，最常用的就是：\n\nhexo n 新建文章/页面\n\nhexo g 生成静态页面\n\nhexo s 本地查看内容\n\nhexo d 部署到Github\n```\n\n\n\n如果需要清除之前生成的内容，可以在生成静态页面前执行hexo clean，其他情况只需要以上四条命令即可。\n\n之后你就可以使用各种各样的主题啦！详细使用主题的教程，看主题的文档就可以了哦！\n","tags":["hexo博客","搭建与部署"],"categories":["hexo"]}]